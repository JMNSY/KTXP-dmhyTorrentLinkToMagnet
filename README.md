KTXP-dmhyTorrentLinkToMagnet
============================
JavaScript用户脚本


脚本作用：<br>使用户能从多个BT资源站点中获取到16位编码的磁链，使之能加入各种离线任务，包括迅雷离线，115；也可以批量添加到transmission,fdm<br>以上是初心，现在只是一个被作者用来复制多个种子链/磁链的工具，多为临时使用，有条件的建议使用flexget<br><br>脚本功能：<br>1.以本地转换的方式取得能被迅雷离线网页版等离线下载站解析的磁链，tracker可配置加上或不加；<br>2.通过页面控件或快捷键跨页添加多行链接（包括磁链和种子链）到剪贴板，目前支持的各站的功能快捷键相互独立互不影响；<br>3.快捷键或网页显示逻辑的配置；<br>3.以不显示来源的方式获取脚本所需的图片；<br>4.令dmhy可以通过网页控件跳转到指定页面；<br>5.显示dmhy全周节目单；<br>6.在dmhy显示种子下载链接；<br><br>关于dmhy中的功能链接：<br>1.排在最上方的加号链接的作用是，把目前勾选的链接（默认磁链，可设为种子链）追加到浏览器本地存储，在此之后把本地存储的内容放入剪贴板，功能与预想不同的时候，请先点击一次垃圾桶链接，清除本地存储中的历史<br>2.排在中间的垃圾桶链接作用是，清空本地存储，并把空字符串放入剪贴板<br>3.排在最下方的复制链接作用与原来不变，把目前勾选的链接（默认磁链，可设为种子链）放到剪贴板<br>4.按下快捷键shift+f1相当于点击加号链接<br>5.按下快捷键shift+f2相当于点击垃圾桶链接<br>6.按下快捷键shift+f4相当于点击复制链接（不使用f3的原因是f3有搜索的功能，在按下组合键之后可能会弹出搜索框）<br><br>关于快捷键的设置：<br>快捷键由mousetrap提供支持，支持类似下列的快捷键（区分大小写）：<br>1.shift+f1    按住shift的情况下，按f1<br>2.a s d       按a，松开，按s，松开，按d，松开（输入时也会触发，慎用）<br>3.esc         按esc键<br>4.command     按command键（按其他快捷键时也可能会触发，慎用）<br>5.ctrl        按ctrl键（按其他快捷键时，例如ctrl+c也可能会触发，慎用）<br>如果在使用过程中快捷键无效或者被玩坏了，可以在反馈中发起讨论寻求解决方案，也可以联系身边会javascript的朋友，咨询符合mousetrap规则的快捷键表达式写法。<br><br>目前支持：<br>1.share.dmhy.org<br>2.miobt.com<br>3.comicat.org<br>4.kisssub.org<br>5.mikanani.me<br><br>//TODO List：<br>1.<del>改进base64编码函数使之能编码汉字(确定不写了，时隔4年的更新都没写还指望个啥)</del><br>2.将某隐藏选项加入界面中<br><br>Change Log：<br>2023-10-07 22:02:02<br>1.修复与东方永页机同时使用导致的转换问题<br>2.删除bt.acg.gg支持<br>3.增加复制不弹确认的设置，清除依旧需要确认<br><br>2023-02-10 23:23:23<br>1.为dmhy,miobt系适配自动翻页工具(特指东方永页机,其余未测试)，acg.gg在编写过程中无法访问<br>2.初步改为js严格模式<br>3.增加支持蜜柑计划(Classic列表以及搜索)，其中搜索页面实际返回了全部数据，但处理时仅处理当前可见数据，并且翻页时清空勾选状态<br>4.修改确认提示框的文本<br><br>2023-01-06 12:02:02<br>1.修复磁链箭头和种子链箭头的href不正常的bug<br>2.调整动漫花园列表中磁链、种子所在列的列宽度<br><br>2022-04-01 11:32:32<br>1.增加了动漫花园不显示pikpak秒播的隐藏选项，需要访问动漫花园按F12打开控制台(Console)执行localStorage.setItem("isShowPikpak","false");<br>2.调整动漫花园列表中的复选框位置，与图标对齐<br>3.修复一个无伤大雅的空指针异常抛出情况<br>4.避免未安装的用户以为该脚本年久失修，无法正常使用(目前在dmhy,miobt,comicat,kisssub应该是可以使用的，使用中有任何问题欢迎反馈)<br><br>2018-04-05 15:52:31<br>1.增加了动漫花园的只复制种子链设置(目前脚本可支持只复制磁链和只复制种子链，默认只复制磁链)<br>2.增加了只复制种子链被勾选时，勾选显示种子链的联动配置<br>3.增加了显示种子链被取消勾选时，取消勾选只复制种子链的联动配置<br>4.调整设置界面的元素堆叠顺序<br>5.避免未安装的用户以为该脚本年久失修，无法正常使用<br><br>2017-01-17 17:20:01<br>1.修复防重部分代码<br>2.修复首次使用脚本追加时可能会复制到null的问题<br>3.对acg.gg增加了可配置快捷键功能，实现与dmhy完全一样，快捷键被初始化为默认快捷键<br>4.对acg.gg增加了多行磁链复制追加功能<br>5.在dmhy中，在当前页页码不为1时，把翻页组件中的输入框值设为当前页码<br><br>2016-11-11 11:11:11<br>1.对miobt增加了可配置快捷键功能，实现与dmhy完全一样，快捷键被初始化为默认快捷键<br>2.修复了非全选复选框的状态改变不影响全选复选框状态的bug<br>3.修复了miobt标题超过两行时不显示磁链图标的bug，把图标提取出来成为单独一列<br>4.修复了设定快捷键不是只读的问题<br><br>2016-09-04 1:37<br>1.修复了在不同的标签页上追加同一个磁链时的BUG<br>2.跳转页面组件实现方式变更，从eval改为事件绑定函数（代码改动，使用上没有任何区别）<br>3.优化流程，显示控件图标选项不被勾上时，不请求图片<br>4.使表头磁链列的宽度随是否显示种子链的配置改变<br>5.去掉对dmhy.dandanplay.com的支持，详情可以访问该站<br>6.添加注释<br>7.以不影响代码易读性为前提提高代码复用度<br>8.去掉国际禁毒日彩蛋<br><br>2016-06-20 23:23<br>1.添加了3个网站的支持<br><br>2016-06-09 23:08<br>1.新增设置，用于隐藏右下角的操作图标，之后只可以用快捷键操作（因此需要谨慎操作）<br><br>2016-05-15 02:28<br>1.修复了页面处于最后一页但不是首页时跳转组件不显示的问题<br>2.增加了跳转输入框的回车监听<br><br>2016-05-15 01:37<br>1.磁链是否带tracker设置在保存后不需要刷新，立即生效<br>2.显示节目单全表，列表固定从周日排列到周六<br>3.增加页面直达，输入页码点击前往即可<br><br>UTC 2016-04-01 17:33<br>1.添加设置界面<br>2.将快捷键，种子下载链是否显示，是否带tracker用设置的方式保存<br><br>2016-03-19 13:55<br>1.修复焦点在输入框等特殊元素是快捷键无效的问题<br><br>2016-03-19 13:04<br>1.添加简单的快捷键操作，shift+f1追加磁链，shift+f2清空剪贴板，shift+f4多行复制<br>2.去除对漫游BT的支持<br>3.去除对dmhy单个资源详情页的支持<br><br>2015-12-19 11:32<br>1.为避免图片存储服务器得知图片在浏览什么网站时被加载，使用用户脚本管理插件提供的接口，在去掉referer的情况下获得图片<br>2.将图片用base64编码显示<br><br>2015-12-12 03:08<br>1.在dmhy新增跨页追加剪贴板磁链功能和清空剪贴板功能<br>2.更改了使用的图标<br>3.将过去引用他人的函数改为使用自编base32 to hex的函数<br>4.更改过去在脚本中存储图标的方式<br><br>2015-08-30 10:44<br>1.在dmhy添加复选框和全选框，在窗口右下角添加一个固定组件，选择要复制的磁链后点击该组件，确认要复制后多行的磁链就复制到剪贴板中。<br>2.代码中添加dmhy种子链显示开关，true为显示，false为不显示<br><br>2015-08-30 05:30<br>1.替换dmhy资源页中的磁链<br>2.支持share.popgo.org<br>3.对dmhy列表页新增种子链<br>4.对代码进行注释<br><br>作者的话：<br>如果脚本运行过程中有什么现象不明白请留下反馈<br>不知不觉快9年了，不是脚本上写着日期我都不知道<br>下面都是私货，我不常在代码里面加私货，就让我在这里加点私货吧，这次私货是该脚本的开发史，记录了部分功能的原始需求。<br>一晃，这个脚本已经诞生快9年了。本来只是在当初用极影的时候由于一复制种子链，迅雷马上以迅雷不及掩耳盗铃之势弹出种子的下载框时怒写的简单脚本(算上空行都不到30行)。因时间的推移，逐渐写了各种各样的功能，也见证了几个网站生命周期的结束：<br>1.dmhy当时的种子登录后才能下载，于是直接把链接换成磁链；<br>2.极影和dmhy磁链中的tracker导致迅雷离线网页版识别缓慢于是去掉；<br>3.由于用户的反馈陆续支持了几个站，又或者因为各种各样的原因去掉了几个站的支持；<br>4.发现了dmhy种子链的规则，加上了种子的下载链接；<br>5.把迅雷离线网页版无法识别的磁链转换为可识别的磁链，一开始用了Chris Miceli的开源函数，后来以自己浅薄的理解另外写了一个转换函数的实现；<br>6.为了解决补动画时一个一个任务添加的尴尬，利用本地存储在dmhy加入了复制多行磁链到剪贴板的功能，并拉上了基友写了迅雷离线网页版的自动加任务脚本；<br>7.为了解决追新番时还是一个一个任务添加的尴尬，在dmhy加入了追加磁链到剪贴板和清空剪贴板的功能，使用户（其实是我自己）能在一个站点中进行跨页向剪贴板追加多个磁链，然后一次性在迅雷离线网页版用基友写的脚本批量添加任务；<br>8.在使用过程中发现在第6点中加入的dmhy页面控件虽然方便，但是需要移动鼠标来点实在没有效率，毕竟复选框离控件还是有距离的，于是加入了快捷键；<br>9.考虑到不同的用户可能绑定了不同的快捷键，以及一些与用户习惯相关的页面定制需求，利用本地存储在dmhy加入了脚本配置功能；<br>10.在dmhy进入了以天数计算的维护之后，想着要爬dmhy页面数据的我偶然发现没有指定页面的跳转控件，于是加了一个可以跳到指定页数的跳转控件；<br>11.工作忙成狗，一周没看新番时发现我想要个全周节目单，于是修改节目单，显示全周的节目；<br>12.享受快捷键的便利的同时，想着过河拆桥去掉页面控件的我，利用了配置功能，加了一个配置用于控制dmhy页面控件的显示；<br>13.想着因为拖延症一直对dmhy以外的站支持不够好，这次3.6版本更新除了修bug以外就专注于类miobt站点的多行磁链复制功能；<br>14.在我看来迅雷离线已经死了的现在，实在是没什么需求去改这个脚本，姑且加上了种子链接复制功能，避免网络情况不好的时候使用磁链获取不到种子；<br>15.有用户反馈3个图标不对齐，于是尽我所能对齐了dmhy的3个图标<br>16.dmhy增加了pikpak秒播的图标，个人用不着，加一个隐藏选项支持把它去掉，默认还是显示
